<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Etcd-load-generator by hroyrh</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Etcd-load-generator</h1>
      <h2 class="project-tagline">generate load on you etcd instance for testing purpose</h2>
      <a href="https://github.com/hroyrh/etcd-load-generator" class="btn">View on GitHub</a>
      <a href="https://github.com/hroyrh/etcd-load-generator/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/hroyrh/etcd-load-generator/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="etcd-load-testing" class="anchor" href="#etcd-load-testing" aria-hidden="true"><span class="octicon octicon-link"></span></a>ETCD Load Testing</h1>

<p>Note : This test, right now, supports only a single node etcd cluster.</p>

<p>This is a etcd load test module written in go-language. It basically creates 
artificial load on a running etcd instance. The test runs for a random set of
keys and values, which can be specified in the configuration file. You can 
configure many other parameters in the config file. See the sample config file 
<em>etcd_load.cfg</em> for more information. </p>

<h2>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>
<p>Memory information</p>

<ul>
<li>gives the memory information about the running etcd instance -- before, 
after and difference, when requests are made</li>
<li>To get this info, use the "-mem" flag while running the module</li>
<li>Also, if the instance is running on a remote machine, then you need to use
the "-remote" flag as well.</li>
<li>The memory information if obtained using the following "pmap" command. Basically
the RSS part of the total memory usage, is used.</li>
</ul>

<pre><code>  $ pmap -x $(pidof etcd) | tail -n1 | awk '{print $4}'
</code></pre>

<h3>
<a id="sample-output-of--pmap--x-pid_of_etcd" class="anchor" href="#sample-output-of--pmap--x-pid_of_etcd" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample Output of : pmap -x $pid_of_etcd</h3>

<pre><code>    3084:   etcd -addr 10.70.1.148:4001
  Address           Kbytes     RSS   Dirty Mode  Mapping
  0000000000400000    3020    2764       0 r-x-- etcd
  00000000006f3000    3316    2996       0 r---- etcd
  0000000000a30000     120     116      28 rw--- etcd
  0000000000a4e000     116      96      96 rw---   [ anon ]
  000000c000000000      36      36      36 rw---   [ anon ]
  000000c207de8000   36448   15188   15188 rw---   [ anon ]
  00007fcc92ad1000    1728     660     660 rw---   [ anon ]
  00007ffc139c0000     132      12      12 rw---   [ stack ]
  00007ffc139ed000       8       0       0 r----   [ anon ]
  00007ffc139ef000       8       4       0 r-x--   [ anon ]
  ffffffffff600000       4       0       0 r-x--   [ anon ]
  ---------------- ------- ------- ------- 
  total kB           44936   21872   16020
</code></pre>
</li>
<li>
<p>Key value distribution</p>

<ul>
<li>This feature basically allows you to specify the distribution of the 
key-values, that is how many keys lie in a particular value range, specified
by "value-range" parameter under section : "section-args", in etcd_load.cfg</li>
<li>See the "pct" parameter under the section :"section-args", in etcd_load.cfg</li>
</ul>
</li>
<li>Value range

<ul>
<li>This allows you to specify value ranges, which will be used for the -- Key
value distribution feature.</li>
<li>Note : length (Value Range) = length (Key Value distribution) + 1</li>
</ul>
</li>
<li>There are other configuration options as well, like -- log-file, remote-flag,
remote-host-user, etcd. . Some of these can be specified using commandline 
flags as well, in which case the flags will override the cfg-file values. To
know more about them see the default config file -- "etcd_load.cfg" and for
help regarding flags, use
    - go run etcd_load.go -h</li>
</ul>

<h2>
<a id="setup" class="anchor" href="#setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup</h2>

<ul>
<li>Make sure that the following packages are in your GOPATH. Set your 
GOPATH if its not already set.
In go, to get a "package" you can simply do : go get package. 
In this use case do it under your GOPATH.</li>
<li>Packages :

<ul>
<li>"github.com/coreos/go-etcd/etcd"</li>
<li>"code.google.com/p/gcfg"</li>
<li>"code.google.com/p/go.crypto/ssh"</li>
</ul>
</li>
<li>Example : 

<ul>
<li>go get "code.google.com/p/gcfg"</li>
</ul>
</li>
<li>Set up a default config file, like the one available in the repo.

<ul>
<li>Below is a sample config file, for more details take a look at etcd_load.cfg</li>
</ul>
</li>
</ul>

<h3>
<a id="sample-config-file" class="anchor" href="#sample-config-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample Config File</h3>

<pre><code>        [section-args]
        etcdhost="127.0.0.1"
        etcdport="4001"
        operation=create
        keycount="100"
        operation-count="200"
        log-file=log
        threads=5 
        pct="5,74,10,10,1"
        value-range="0,256,512,1024,8192,204800"
        remote-flag=False
        ssh-port=22
        remote-host-user=root
</code></pre>

<h2>
<a id="build" class="anchor" href="#build" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build</h2>

<ul>
<li>Now, to run etcd_load test, use the following steps</li>
</ul>

<pre><code> $ go build etcd_load.go report.go
</code></pre>

<h2>
<a id="running-the-test" class="anchor" href="#running-the-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running the Test</h2>

<ul>
<li>./etcd_load -c config_file [flag]

<ul>
<li>flags : -help , -h , -p , -o , -k , -oc , -log , -mem , -remote</li>
<li>For details regarding the flags , use :
<code>
$ go run etcd_load.go -help
</code>
</li>
</ul>
</li>
<li>
<p>Examples :</p>

<p>[remote etcd instance]</p>

<pre><code>$ ./etcd_load -c etcd_load.cfg -mem -remote -o create  
$ ./etcd_load -c etcd_load.cfg -h 10.10.10.1 -p 4001 -o create 
</code></pre>

<p>[local etcd instance]</p>

<pre><code>$ ./etcd_load -c etcd_load.cfg -h 127.0.0.1 -o create 
</code></pre>

<p>Note that the "-c" flag is compulsory, that is you need to have a default 
config file that must be input using the -c flag
To know more about the flags :: do -- go run etcd_load.go -h</p>
</li>
</ul>

<h2>
<a id="result" class="anchor" href="#result" aria-hidden="true"><span class="octicon octicon-link"></span></a>Result</h2>

<ul>
<li>You can find more runtime details in the log file. </li>
<li>The commandline the report looks like :</li>
</ul>

<hr>

<pre><code>Summary:
  Total:    2.8454 secs.
  Slowest:  0.1493 secs.
  Fastest:  0.0001 secs.
  Average:  0.0258 secs.
  Requests/sec: 35.1449

Response time histogram:
  0.000 [1]     |
  0.015 [17]    |∎∎∎∎∎∎∎∎∎∎∎∎∎∎
  0.030 [48]    |∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎
  0.045 [27]    |∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎
  0.060 [3]     |∎∎
  0.075 [2]     |∎
  0.090 [0]     |
  0.105 [1]     |
  0.119 [0]     |
  0.134 [0]     |
  0.149 [1]     |

Latency distribution:
  10% in 0.0006 secs.
  25% in 0.0226 secs.
  50% in 0.0240 secs.
  75% in 0.0308 secs.
  90% in 0.0332 secs.
  95% in 0.0481 secs.
  99% in 0.1493 secs.
</code></pre>

<h2>
<a id="credit-" class="anchor" href="#credit-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Credit ::</h2>

<ul>
<li>The report.go file in the package is used from the "boom" package, here is the link

<ul>
<li><a href="https://github.com/rakyll/boom/blob/master/boomer/print.go">https://github.com/rakyll/boom/blob/master/boomer/print.go</a></li>
</ul>
</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/hroyrh/etcd-load-generator">Etcd-load-generator</a> is maintained by <a href="https://github.com/hroyrh">hroyrh</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
